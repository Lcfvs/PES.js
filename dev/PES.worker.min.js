/*Copyright 2013 Lcf.vs - Released under the MIT license - https://github.com/Lcfvs/PES.js*/var PES;(function(){"use strict";var e,t,n,r,i,s,o,u;e=function(){this.encrypt=i;this.decrypt=s};t={"utf-8":65536};n=function a(e){var t,n,r;t=0;n=[];r=e.length;try{while(t<r){n.push(e.charCodeAt(t));t+=1}}catch(i){n=n.concat(a(e.substring(t)))}return n};r=function(e,i,s,u){var a,f,l;if(e.length===0){throw new Error("Invalid encryption key length")}a=u||"";try{while(a.length<i){f=n(e);l=n(a||e);o(f,l,t[s],f.length-1,0);a+=String.fromCharCode.apply(null,f)}}catch(c){a+=r(e,i,s,a)}if(u===undefined){f=n(e);l=n(a);o(f,l,t[s],f.length-1,0);a+=String.fromCharCode.apply(null,f)}return a};i=function(i,s,u){var a,f;a=n(i);f=n(r(s,a.length,u));o(a,f,t[u],a.length-1,0);return String.fromCharCode.apply(null,a)};s=function(i,s,o){var a,f;a=n(i);f=n(r(s,a.length,o));u(a,f,t[o],0,f.length-1);return String.fromCharCode.apply(null,a)};o=function f(e,t,n,r,i){var s,o,u,a,l,c,h,p,d;s=e.length;o=s-1;u=t.length;l=t[i];try{while(i<u){if(r===o){h=Math.min.apply(null,e);p=Math.max.apply(null,e);d=(p-h)%s;e.splice.bind(e,0,s).apply(e,e.slice(d).concat(e.slice(0,d)));if((h^p^l^n)&1){e.reverse()}}a=e[r];c=r!==0?e[r-1]:l;e[r]=c+a^l;if(e[r]>=n){e[r]-=n}if(r===0){r=o;i+=1;l=t[i]}else{r-=1}}}catch(v){f(e,t,n,r,i)}return e};u=function l(e,t,n,r,i){var s,o,u,a,f,c,h,p;s=e.length;o=s-1;a=t[i];try{while(i>-1){u=e[r];f=r!==0?e[r-1]:a;e[r]=(e[r]^a)-f;if(e[r]<0){e[r]+=n}if(r===o){c=Math.min.apply(null,e);h=Math.max.apply(null,e);if((c^h^a^n)&1){e.reverse()}p=s-(h-c)%s;e.splice.bind(e,0,s).apply(e,e.slice(p).concat(e.slice(0,p)));r=0;i-=1;a=t[i]}else{r+=1}}}catch(d){l(e,t,n,r,i)}return e};self.PES=new e})();self.addEventListener("message",function(e){var t,n,r,i;t=e.data;n=t.method;r=t.key;i=t.data;if(n==="encrypt"){i=btoa(unescape(encodeURIComponent(escape(PES[n](i,r,"utf-8"))))).replace(/JX(.{6})/g,"$1")}else{i=PES[n](unescape(decodeURIComponent(escape(atob(i.replace(/(.{6})/g,"JX$1"))))),r,"utf-8")}self.postMessage({type:"result",data:i})},false)
