/*
Copyright 2013 Lcf.vs
Released under the MIT license
https://github.com/Lcfvs/PES.js
*/
'use strict';
var PES=(($,a=256,b=a*a,c='forEach',d='charCodeAt',e=String,f='base64',g='binary',h='slice',k=z=>[].map.call(z.normalize('NFKC'),y=>y.codePointAt(0)),l=z=>e.fromCodePoint.apply(null,z),m=(z,y=[])=>(z.split('')[c]((x,w)=>(!(w&1)&&y.push(z[d](w)*a+z[d](w+1)))),y),n=(z,y=[])=>e.fromCharCode.apply(null,(z[c](x=>y.push(x>>>8,x%a)),y)),o=(z,y,x,w)=>y?y(z):(new Buffer(z,x)).toString(w),p=(z,y,x=t(z,z),w=(v=t(x,z))=>(x=x.concat(v),x.length>y?x:w()))=>w(),q=z=>z.reduce((y,x)=>y<x?y:x),r=z=>z.reduce((y,x)=>y>x?y:x),s=(z,y)=>((q(z)^r(z)^y)&1&&z.reverse(),z),t=(z,y)=>(z=z[h](0),y=y[h](0),y[c]((x,w)=>(w=x,z=s(z.map((z,y)=>(y=(w+z^x)%b,w=z,y)),x))),z),u=(z,y)=>(z=z[h](0),y=y[h](0),y.reverse(),y[c]((x,w)=>(w=x,z=s(z,x).map(z=>w=((z^x)-w+b)%b))),z))=>({encrypt:(z,y)=>((x=k(z))=>o(n(t(x,p(k(y),x.length))),$.btoa,g,f))(),decrypt:(z,y)=>((x=m(o(z,$.atob,f,g)))=>l(u(x,p(k(y),x.length))))()}))(typeof global==='object'?global:this);
$.addEventListener('message',(e,m=e.data)=>$.postMessage({type:'result',data:a[m.method](m.data,m.key)})},!1);